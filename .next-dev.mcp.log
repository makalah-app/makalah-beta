  ‚ñ≤ Next.js 14.2.32
  - Local:        http://localhost:3000
  - Environments: .env.local

 ‚úì Starting...
 ‚úì Ready in 2.7s
 ‚óã Compiling /chat ...
 ‚úì Compiled /chat in 9.4s (1631 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
 GET /chat 200 in 10134ms
 ‚óã Compiling /api/chat/history ...
 ‚úì Compiled /api/chat/history in 5.3s (1084 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 5757ms
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 100ms
 ‚óã Compiling /api/chat ...
 ‚úì Compiled /api/chat in 524ms (1095 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[Chat API] Initializing NATIVE OpenAI web search system...
[Chat API] üåê Using built-in OpenAI web search - no mock data!
[Chat API] üìã ChatId from headers: cd44f990-5a5e-4929-8067-7f528583317c
[Chat API] Processing 1 messages, Phase: 1
[Chat API] First message structure: {
  id: 'T5hBDRhP9i5c5sim',
  role: 'user',
  hasContent: true,
  hasMetadata: false
}
[Chat API] ‚úÖ Successfully converted 1 UI messages to 1 model messages (filtered 0 approval parts)
[DynamicConfig] Loading current provider configuration from database...
[DynamicConfig] DEBUG: Raw configs from database: [
  {
    id: 'ab0706bb-7283-4bba-bf45-7e174a95fff6',
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true,
    is_active: true
  },
  {
    id: '977b5b59-2fca-468b-9cdb-e9fef132081d',
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true,
    is_active: true
  }
]
[DynamicConfig] DEBUG: Sorted configs: [
  {
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true
  },
  {
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true
  }
]
[DynamicConfig] Current provider order: Primary=openrouter, Fallback=openai
[DynamicConfig] DEBUG: Creating providers - OpenAI key available: true, OpenRouter key available: true
[DynamicConfig] DEBUG: Custom OpenAI provider created: function
[DynamicConfig] DEBUG: OpenRouter provider created: function
[DynamicConfig] DEBUG: Creating models with provider=openrouter
[DynamicConfig] DEBUG: Creating OpenRouter primary model with: google/gemini-2.5-flash
[DynamicConfig] DEBUG: Creating OpenAI fallback model with: gpt-4o
[DynamicConfig] DEBUG: Models created successfully - Primary: object, Fallback: object
[DynamicConfig] ‚úÖ Configuration loaded successfully
[DynamicConfig] Primary: openrouter, Fallback: openai
[Chat API] üöÄ HITL Integration: Processing tool results and handling approvals
[HITL] Processing tool results for approval handling
[HITL] Processing 1 message parts for tool results
[Chat API] ‚úÖ Returning createUIMessageStreamResponse with HITL integration
[Chat API] üîß Using DYNAMIC PRIMARY: openrouter (from database config)
[Chat API] üîç DEBUG finalProcessedMessages: {
  type: 'object',
  isArray: true,
  length: 1,
  sample: { parts: [ [Object] ], id: 'T5hBDRhP9i5c5sim', role: 'user' }
}
[Chat API] üîç DEBUG manualMessages: [
  {
    role: 'user',
    content: 'Tolong cari dan ringkas perkembangan terbaru EU AI Act per 2025. Wajib sertakan 3‚Äì5 sitasi berupa tautan URL sumber yang akurat (bukan blog spam), pakai format [1], [2], [3] di kalimat. Di akhir, tampilkan daftar Referensi bernomor yang cocok (1‚Äì5) berisi judul singkat + URL.'
  }
]
[Chat API] üõ†Ô∏è Tools enabled: openai.tools.webSearchPreview (Responses API)
[Chat API] ‚úÖ Native OpenAI web search initialized
[Chat API] ‚úÖ Primary stream merged with proper completion
[Chat API] ‚úÖ Primary execution FULLY completed - fallback will be blocked
[Chat API] üîÑ Initiated async message persistence (fire-and-forget)
 POST /api/chat 200 in 9349ms
[MessagePersistence] üîÑ Starting async persistence for 1 messages
[MessagePersistence] üìù Persisting 1 messages to database
[saveChat] Saving 1 messages for chat cd44f990-5a5e-4929-8067-7f528583317c
[ensureConversationExists] Error creating conversation: {
  code: '23505',
  details: 'Key (id)=(cd44f990-5a5e-4929-8067-7f528583317c) already exists.',
  hint: null,
  message: 'duplicate key value violates unique constraint "conversations_pkey"'
}
[saveChat] Database save failed for chat cd44f990-5a5e-4929-8067-7f528583317c after 395ms: Error: Failed to create or retrieve conversation for chatId: cd44f990-5a5e-4929-8067-7f528583317c
    at saveChat (webpack-internal:///(rsc)/./src/lib/database/chat-store.ts:65:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async performMessagePersistence (webpack-internal:///(rsc)/./src/lib/database/message-persistence.ts:112:9)
    at async Immediate.eval (webpack-internal:///(rsc)/./src/lib/database/message-persistence.ts:55:28)
[saveChat] üîÑ Attempting fallback save for chat cd44f990-5a5e-4929-8067-7f528583317c
[Fallback] Saving 1 messages for chat cd44f990-5a5e-4929-8067-7f528583317c to localStorage
[Fallback] Successfully saved 1 messages in 0ms (fallback mode)
[Fallback Performance] saveChat-fallback-cd44f990-5a5e-4929-8067-7f528583317c completed in 1ms (fallback mode)
[saveChat] ‚úÖ Successfully saved to fallback for chat cd44f990-5a5e-4929-8067-7f528583317c
[MessagePersistence] ‚úÖ Successfully persisted 1 messages in 398ms
[MessagePersistence] ‚úÖ Async persistence completed: {
  conversationId: 'cd44f990-5a5e-4929-8067-7f528583317c',
  messagesStored: 1,
  duration: 398
}
 ‚óã Compiling / ...
 ‚úì Compiled / in 2.4s (1621 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
 GET / 200 in 2836ms
 ‚óã Compiling /auth ...
 ‚úì Compiled /auth in 660ms (1633 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
 GET /auth 200 in 962ms
 GET /chat 200 in 241ms
 ‚úì Compiled /api/chat/history in 315ms (1094 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 705ms
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 74ms
 ‚úì Compiled /api/chat in 269ms (1105 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[Chat API] Initializing NATIVE OpenAI web search system...
[Chat API] üåê Using built-in OpenAI web search - no mock data!
[Chat API] üìã ChatId from headers: d716cffe-6dfb-4049-a505-41677be1e789
[Chat API] Processing 1 messages, Phase: 1
[Chat API] First message structure: {
  id: 'iUhAo02O0yHupByB',
  role: 'user',
  hasContent: true,
  hasMetadata: false
}
[Chat API] ‚úÖ Successfully converted 1 UI messages to 1 model messages (filtered 0 approval parts)
[DynamicConfig] Loading current provider configuration from database...
[DynamicConfig] DEBUG: Raw configs from database: [
  {
    id: 'ab0706bb-7283-4bba-bf45-7e174a95fff6',
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true,
    is_active: true
  },
  {
    id: '977b5b59-2fca-468b-9cdb-e9fef132081d',
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true,
    is_active: true
  }
]
[DynamicConfig] DEBUG: Sorted configs: [
  {
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true
  },
  {
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true
  }
]
[DynamicConfig] Current provider order: Primary=openrouter, Fallback=openai
[DynamicConfig] DEBUG: Creating providers - OpenAI key available: true, OpenRouter key available: true
[DynamicConfig] DEBUG: Custom OpenAI provider created: function
[DynamicConfig] DEBUG: OpenRouter provider created: function
[DynamicConfig] DEBUG: Creating models with provider=openrouter
[DynamicConfig] DEBUG: Creating OpenRouter primary model with: google/gemini-2.5-flash
[DynamicConfig] DEBUG: Creating OpenAI fallback model with: gpt-4o
[DynamicConfig] DEBUG: Models created successfully - Primary: object, Fallback: object
[DynamicConfig] ‚úÖ Configuration loaded successfully
[DynamicConfig] Primary: openrouter, Fallback: openai
[Chat API] üöÄ HITL Integration: Processing tool results and handling approvals
[HITL] Processing tool results for approval handling
[HITL] Processing 1 message parts for tool results
[Chat API] ‚úÖ Returning createUIMessageStreamResponse with HITL integration
[Chat API] üîß Using DYNAMIC PRIMARY: openrouter (from database config)
[Chat API] üîç DEBUG finalProcessedMessages: {
  type: 'object',
  isArray: true,
  length: 1,
  sample: { parts: [ [Object] ], id: 'iUhAo02O0yHupByB', role: 'user' }
}
[Chat API] üîç DEBUG manualMessages: [
  {
    role: 'user',
    content: 'Test message untuk mengecek chat history functionality'
  }
]
[Chat API] üõ†Ô∏è Tools enabled: openai.tools.webSearchPreview (Responses API)
[Chat API] ‚úÖ Native OpenAI web search initialized
[Chat API] ‚úÖ Primary stream merged with proper completion
[Chat API] ‚úÖ Primary execution FULLY completed - fallback will be blocked
[Chat API] üîÑ Initiated async message persistence (fire-and-forget)
 POST /api/chat 200 in 3022ms
[MessagePersistence] üîÑ Starting async persistence for 1 messages
[MessagePersistence] üìù Persisting 1 messages to database
[saveChat] Saving 1 messages for chat d716cffe-6dfb-4049-a505-41677be1e789
[saveChat] Successfully saved 1 messages in 427ms
[MessagePersistence] ‚úÖ Successfully persisted 1 messages in 427ms
[MessagePersistence] ‚úÖ Async persistence completed: {
  conversationId: 'd716cffe-6dfb-4049-a505-41677be1e789',
  messagesStored: 1,
  duration: 427
}
<w> [webpack.cache.PackFileCacheStrategy] Restoring pack from /Users/eriksupit/Desktop/makalah/makalahApp/.next/cache/webpack/client-development.pack.gz failed: TypeError: Cannot read properties of undefined (reading 'hasStartTime')
 ‚óã Compiling /_not-found ...
 ‚úì Compiled /_not-found in 1787ms (1869 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=50 404 in 2024ms
 ‚úì Compiled /api/chat in 245ms (1099 modules)
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
[Chat API] Initializing NATIVE OpenAI web search system...
[Chat API] üåê Using built-in OpenAI web search - no mock data!
[Chat API] üìã ChatId from headers: d716cffe-6dfb-4049-a505-41677be1e789
[Chat API] Processing 3 messages, Phase: 1
[Chat API] First message structure: {
  id: 'iUhAo02O0yHupByB',
  role: 'user',
  hasContent: true,
  hasMetadata: false
}
[Chat API] ‚úÖ Successfully converted 3 UI messages to 3 model messages (filtered 0 approval parts)
[DynamicConfig] Loading current provider configuration from database...
[DynamicConfig] DEBUG: Raw configs from database: [
  {
    id: 'ab0706bb-7283-4bba-bf45-7e174a95fff6',
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true,
    is_active: true
  },
  {
    id: '977b5b59-2fca-468b-9cdb-e9fef132081d',
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true,
    is_active: true
  }
]
[DynamicConfig] DEBUG: Sorted configs: [
  {
    provider: 'openrouter',
    model_name: 'google/gemini-2.5-flash',
    created_at: '2025-09-11T14:54:35.585+00:00',
    is_default: true
  },
  {
    provider: 'openai',
    model_name: 'gpt-4o',
    created_at: '2025-09-11T14:54:35.485+00:00',
    is_default: true
  }
]
[DynamicConfig] Current provider order: Primary=openrouter, Fallback=openai
[DynamicConfig] DEBUG: Creating providers - OpenAI key available: true, OpenRouter key available: true
[DynamicConfig] DEBUG: Custom OpenAI provider created: function
[DynamicConfig] DEBUG: OpenRouter provider created: function
[DynamicConfig] DEBUG: Creating models with provider=openrouter
[DynamicConfig] DEBUG: Creating OpenRouter primary model with: google/gemini-2.5-flash
[DynamicConfig] DEBUG: Creating OpenAI fallback model with: gpt-4o
[DynamicConfig] DEBUG: Models created successfully - Primary: object, Fallback: object
[DynamicConfig] ‚úÖ Configuration loaded successfully
[DynamicConfig] Primary: openrouter, Fallback: openai
[Chat API] üöÄ HITL Integration: Processing tool results and handling approvals
[HITL] Processing tool results for approval handling
[HITL] Processing 1 message parts for tool results
[Chat API] ‚úÖ Returning createUIMessageStreamResponse with HITL integration
[Chat API] üîß Using DYNAMIC PRIMARY: openrouter (from database config)
[Chat API] üîç DEBUG finalProcessedMessages: {
  type: 'object',
  isArray: true,
  length: 3,
  sample: { parts: [ [Object] ], id: 'iUhAo02O0yHupByB', role: 'user' }
}
[Chat API] üîç DEBUG manualMessages: [
  {
    role: 'user',
    content: 'Test message untuk mengecek chat history functionality'
  },
  {
    role: 'assistant',
    content: 'Tentu! Saya di sini untuk membantu. Apakah ada yang ingin Anda tanyakan atau diskusikan lebih lanjut?'
  },
  {
    role: 'user',
    content: 'Message kedua untuk test persistence dan saveChat function'
  }
]
[Chat API] üõ†Ô∏è Tools enabled: openai.tools.webSearchPreview (Responses API)
[Chat API] ‚úÖ Native OpenAI web search initialized
[Chat API] ‚úÖ Primary stream merged with proper completion
[Chat API] ‚úÖ Primary execution FULLY completed - fallback will be blocked
[Chat API] üîÑ Initiated async message persistence (fire-and-forget)
 POST /api/chat 200 in 3806ms
[MessagePersistence] üîÑ Starting async persistence for 3 messages
[MessagePersistence] üìù Persisting 3 messages to database
[saveChat] Saving 3 messages for chat d716cffe-6dfb-4049-a505-41677be1e789
[ensureConversationExists] Error creating conversation: {
  code: '23505',
  details: 'Key (id)=(d716cffe-6dfb-4049-a505-41677be1e789) already exists.',
  hint: null,
  message: 'duplicate key value violates unique constraint "conversations_pkey"'
}
[saveChat] Database save failed for chat d716cffe-6dfb-4049-a505-41677be1e789 after 226ms: Error: Failed to create or retrieve conversation for chatId: d716cffe-6dfb-4049-a505-41677be1e789
    at saveChat (webpack-internal:///(rsc)/./src/lib/database/chat-store.ts:65:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async performMessagePersistence (webpack-internal:///(rsc)/./src/lib/database/message-persistence.ts:112:9)
    at async Immediate.eval (webpack-internal:///(rsc)/./src/lib/database/message-persistence.ts:55:28)
[saveChat] üîÑ Attempting fallback save for chat d716cffe-6dfb-4049-a505-41677be1e789
[Fallback] Saving 3 messages for chat d716cffe-6dfb-4049-a505-41677be1e789 to localStorage
[Fallback] Successfully saved 3 messages in 0ms (fallback mode)
[Fallback Performance] saveChat-fallback-d716cffe-6dfb-4049-a505-41677be1e789 completed in 0ms (fallback mode)
[saveChat] ‚úÖ Successfully saved to fallback for chat d716cffe-6dfb-4049-a505-41677be1e789
[MessagePersistence] ‚úÖ Successfully persisted 3 messages in 227ms
[MessagePersistence] ‚úÖ Async persistence completed: {
  conversationId: 'd716cffe-6dfb-4049-a505-41677be1e789',
  messagesStored: 3,
  duration: 227
}
‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217
 GET /chat?chatId=d716cffe-6dfb-4049-a505-41677be1e789 200 in 421ms
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 301ms
[Chat History API] Loading history for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b {
  conversationId: null,
  limit: 20,
  offset: 0,
  phase: undefined,
  dateFrom: null,
  dateTo: null,
  messageType: null
}
[getUserConversations] Found 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
[Chat History API] Returning 0 conversations for user 38967a42-3fdb-4d08-8768-bce6f97e3f0b
 GET /api/chat/history?userId=38967a42-3fdb-4d08-8768-bce6f97e3f0b&limit=20 200 in 83ms
 HEAD / 200 in 32ms
 GET /robots.txt 404 in 27ms
<w> [webpack.cache.PackFileCacheStrategy] Restoring pack from /Users/eriksupit/Desktop/makalah/makalahApp/.next/cache/webpack/server-development.pack.gz failed: TypeError: Cannot read properties of undefined (reading 'hasStartTime')
 ‚úì Compiled in 2.1s (1626 modules)
